<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Wikidata | Gauquelin5</title>
    <link href="static/gauquelin5.css" rel="stylesheet" type="text/css">
    <meta name="description" content="">
    <meta name="robots" content="index,follow">
    <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
    <meta name="dcterms.rights" content="Creative commons by-sa 4.0">
    <meta name="dcterms.rightsHolder" content="Thierry Graff">
    <meta name="dcterms.dateCopyrighted" content="2019">
    <!-- 
    tigsite:
        history: , Thierry Graff : Creation
    -->
</head>

<body>
<div class="container">

<div class="main">

<nav class="prevnext">
    <a class="top" href="index.html">&uarr;</a>
</nav>

<header>
<h1>Wikidata integration</h1>
<div class="intro">
An important feature of "good data" is the ability to connect them to other datasets. This permits to check, eventually correct them, and provides means to build new datasets. Current page explores the possibility to connect Gauquelin data with <a href="https://www.wikidata.org">wikidata.org</a>. From wikidata, it's possible to link with other standard ids (ISNI, VIAF etc.).
<br>Matching wikidata with Gauquelin data has not (yet) been coded ; this page only explains how to retrieve relevant data from wikidata.org locally.
<br>
</div>
</header>

<article>
<nav class="toc">
    <ul>
        <li>
            <a href="#summary">Summary</a>
            <ul>
                <li><a href="#1-1-in-practice">In practice</a></li>
            </ul>
        </li>
        <li>
            <a href="#get-occupation-codes">Get occupation codes</a>
        </li>
        <li>
            <a href="#try-elaborate-queries">Try elaborate queries</a>
        </li>
        <li>
            <a href="#use-minimal-queries">Use minimal queries</a>
        </li>
        <li>
            <a href="#download-individual-json">Download individual json</a>
        </li>
    </ul>
</nav>











<!-- ********************************************************************************* -->
<h2><a name="summary">Summary</a></h2>
I tried <a href="https://query.wikidata.org/">Wikidata Query Service</a> (WDQS), learning rudiments of sparql for the occasion (see <a href="https://github.com/tig12/gauquelin5/tree/master/share/wikidata.org/wikidata-sparql-tuto.txt">wikidata-sparql-tuto.txt</a>).
<br>I started to retrieve professional groups and wrote code to see if it can be matched with Gauquelin data, and had very bad matching rates. This could be bettered with more elaborate matching procedures. For example, to match a french person, the name should be matched with french label.
<br>So I wrote queries to get more information, and quickly faced "time out" problems.
<br>I didn't try very hard on query optimization and looked if I could install wikidata on my machine, but I was scared by the 38 Gb bz2 file to download the data.
<br>Then I saw that it was possible to download the entities one by one, obtaining json files. This gives a solution :
<ul>
    <li>
        Use query service to build csv files containing the wikidata ids of persons belonging to different professional groups. Asking just the id (and eventually a label) doesn't time out.
    </li>
    <li>
        Download the entities that are stored in these csv files to get one json per person.
    </li>
</ul>

These json files contain all the informations available about entities ; they can be used to try to write the matching between Gauquelin and wikidata.

<!-- ************************************* -->
<h3><a name="1-1-in-practice">In practice</a></h3>
Some sparql queries used to retrieve wikidata data are in <a href="https://github.com/tig12/gauquelin5/tree/master/share/wikidata.org">github.com/tig12/gauquelin5/tree/master/share/wikidata.org</a>
<br>The csv files retrieved using WDQS are stored in <code>data/1-raw/wikidata.org</code> - This directory can be set using <code>1-wd-raw</code> entry of <code>config.yml</code>.



<!-- ********************************************************************************* -->
<h2><a name="get-occupation-codes">Get occupation codes</a></h2>
This was done using <code>profession Q28640</code> (which is a subclass of <code>occupation Q12737077</code>).
<br>
<br>Examples of queries which give lists of occupation codes, stored in <code>1-wd-raw/professions/</code> :
<pre>
# Lists of professions - professions1.csv
# ----------------------------------------------------------------------
SELECT ?profession ?professionLabel
WHERE{
    ?profession wdt:P31 wd:Q28640.
	SERVICE wikibase:label { bd:serviceParam wikibase:language "en" }
}
ORDER BY (?professionLabel)
</pre>
<pre>
# List of subclasses of scientist - scientist-subclasses.csv
# ----------------------------------------------------------------------
SELECT ?scientist ?scientistLabel
WHERE{
    ?scientist wdt:P279 wd:Q901.
	SERVICE wikibase:label { bd:serviceParam wikibase:language "en" }
}
ORDER BY (?scientistLabel)
</pre>

<!-- ********************************************************************************* -->
<h2><a name="try-elaborate-queries">Try elaborate queries</a></h2>

Previous step generates csv files containing profession (or occupation) codes. It is then possible to build one query per occupation code to retrieve the persons associated with this occupation, stored in <code>1-wd-raw/professionals/</code>.
<br>
<br>Example of query to try to retrieve mathematicians (Q170790) with information about each person :

<pre>
SELECT DISTINCT ?person ?personLabel ?familynameLabel ?linkcount ?isni ?macTutor ?birthdate ?birthplace ?birthplaceLabel ?birthiso3166 ?birthgeonamesid ?birthcoords ?deathdate ?deathplace ?deathplaceLabel ?deathiso3166 ?deathgeonamesid ?deathcoords ?deathcause ?deathcauseLabel WHERE {
    ?person ?P31 wd:Q170790;
        wdt:P734 ?familyname;
        # wdt:P735 ?givenname;
        wdt:P569 ?birthdate;
        wdt:P19 ?birthplace;
        wikibase:sitelinks ?linkcount .
    OPTIONAL { ?person wdt:P1563 ?macTutor } .
    OPTIONAL { ?person wdt:P213 ?isni } .
    # birth
    ?birthplace wdt:P625 ?birthcoords .
    OPTIONAL { ?birthplace wdt:P1566 ?birthgeonamesid } .
    OPTIONAL { ?birthplace wdt:P17 ?birthcountry }.
    OPTIONAL { ?birthcountry wdt:P297 ?birthiso3166 }.
    # death
    OPTIONAL { ?person wdt:P570 ?deathdate } .
    OPTIONAL { ?person wdt:P20 ?deathplace } .
    OPTIONAL { ?deathplace wdt:P625 ?deathcoords }.
    OPTIONAL { ?deathplace wdt:P1566 ?deathgeonamesid } .
    OPTIONAL { ?deathplace wdt:P17 ?deathcountry }.
    OPTIONAL { ?deathcountry wdt:P297 ?deathiso3166 }.
    OPTIONAL { ?person wdt:P509 ?deathcause }.
    #
    SERVICE wikibase:label { bd:serviceParam wikibase:language "en". }
}
ORDER BY DESC(?linkcount)
</pre>

This kind of query sometimes gives result for soe profession codes, but often times out.


<!-- ********************************************************************************* -->
<h2><a name="use-minimal-queries">Use minimal queries</a></h2>

To circumvent time out, it is possible to write minimal queries, that will retrieve only the ids of the persons assoiated with a given profession code :

<pre>SELECT DISTINCT ?person ?personLabel
WHERE {
    ?person ?P31 wd:Q170790;
    SERVICE wikibase:label { bd:serviceParam wikibase:language "en". }
}
</pre>

<!-- ********************************************************************************* -->
<h2><a name="download-individual-json">Download individual json</a></h2>
Csv files generated by previous queries contain ids of persons, and these ids can be used to retrieve one by one json files containing the full informations about each person, using the per item access to wikidata.
<br>For example, <a href="http://www.wikidata.org/wiki/Special:EntityData/Q41390.json">wikidata.org/wiki/Special:EntityData/Q41390.json</a> contains informations about Kurt Gödel.



</article>
</div><!-- end class="main" -->


<!-- ************************************* -->
<aside class="left">                                                                                                                                              
<ul>
    <li class="bold big1"><a href="index.html">g5 Doc</a></li>
    <li class="bold big1"><a href="https://github.com/tig12/gauquelin5">g5 code</a></li>
    <li><a href="organisation.html">Organisation</a></li>
    <li><a href="usage.html">Program usage</a></li>
    
    <li>
        <span class="big1">1 - Restore</span>
        <ul>
            <li><a href="output-format.html">Output format</a></li>
            
            <li><a href="cura.html">Cura data</a></li>
            
            <li>
                <ul>
                    <a href="cura-A.html">A</a>
                    <a href="cura-D6.html">D6</a>
                    <a href="cura-D10.html">D10</a>
                    <a href="cura-E1-E3.html">E1 E3</a>
                <li><a href="cura-results.html">Results</a></li>
                </ul>
            </li>
            
            <li>
                Gauquelin 1955
                <ul>
                    <li><a href="g55-restore.html">Restoration</a></li>
                    <li><a href="g55-curadiff.html">Differences with Cura</a></li>
                </ul>
            </li>
            
            <li>
                <a href="newalch.html">Newalchemypress data</a>
                <ul>
                    <li><a href="newalch-ertel4391.html">Ertel 4391</a></li>
                    <li><a href="newalch-muller1083.html">Müller 1083</a></li>
                </ul>
            </li>
            
            <li><a href="time.html">Expressing time</a></li>
            
            <li>
                Steps
                <ul>
                    <li><a href="tweak2csv.html">tweak2csv</a></li>
                </ul>
            </li>
            
        </ul>
    </li>
    
    <li>
        <span class="big1">2 - Build new data</span>
        <ul>
            <li><a href="geonames.html">Geonames.org</a></li>
            <li><a href="wikidata.html">Wikidata.org</a></li>
        </ul>
    </li>
        
    <li>
        <span class="big1">3 - Eminence</span>
        <ul>
            <li><a href="eminence.html">Eminence ranking</a></li>
        </ul>
    </li>
    
    
    <li><a href="code-details.html">Code details</a></li>
    
    <!-- <li><a href="next.html">Next</a></li> -->
    
    <!-- <li><a href="questions.html">Questions</a></li> -->
    
    <li>
        Doc
        <ul>
            <li><a href="historical-tests.html">List of historical tests</a></li>
        </ul>
    </li>
    
    <li class="bold big1"><a href="https://larzac.info/gauquelin5">Download results</a></li>
    
</ul>
</aside>

</div><!-- end class="container" -->

</body>
</html>
<!-- ************************************* -->
<!-- ********************************************************************************* -->
