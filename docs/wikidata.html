<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Wikidata | Gauquelin5</title>
    <link href="static/gauquelin5.css" rel="stylesheet" type="text/css">
    <meta name="description" content="">
    <meta name="robots" content="index,follow">
    <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
    <meta name="dcterms.rights" content="Creative commons by-sa 4.0">
    <meta name="dcterms.rightsHolder" content="Thierry Graff">
    <meta name="dcterms.dateCopyrighted" content="2019">
    <!-- 
    tigsite:
        history: , Thierry Graff : Creation
    -->
</head>

<body>
<div class="container">

<div class="main">

<nav class="prevnext">
    <a class="top" href="index.html">&uarr;</a>
</nav>

<header>
<h1>Wikidata integration</h1>
<div class="intro">
An important feature of "good data" is the ability to connect them to other datasets. This permits to check, eventually correct them, and provides means to build new datasets. Current page explores the possibility to connect Gauquelin data with <a href="https://www.wikidata.org">wikidata.org</a>. From wikidata, it's possible to link with other standard ids (ISNI, VIAF etc.).
<br>Matching wikidata with Gauquelin data has not (yet) been coded ; this page only explains how to retrieve relevant data from wikidata.org locally.
<br>
</div>
</header>

<article>
<nav class="toc">
    <ul>
        <li>
            <a href="#summary">Summary</a>
            <ul>
                <li><a href="#1-1-in-practice">In practice</a></li>
            </ul>
        </li>
        <li>
            <a href="#step-1-get-occupation-codes">Step 1 - Get occupation codes</a>
        </li>
        <li>
            <a href="#step-2-retrieve-lists-of-persons">Step 2 - Retrieve lists of persons</a>
        </li>
        <li>
            <a href="#step-3-retrieve-persons-one-by-one">Step 3 - Retrieve persons one by one</a>
        </li>
        <li>
            <a href="#try-elaborate-queries">Try elaborate queries</a>
        </li>
        <li>
            <a href="#use-minimal-queries">Use minimal queries</a>
        </li>
        <li>
            <a href="#download-individual-json">Download individual json</a>
        </li>
    </ul>
</nav>




<!-- ********************************************************************************* -->
<h2><a name="summary">Summary</a></h2>

Wikidata can be queried through <a href="https://query.wikidata.org/">Wikidata Query Service</a> (WDQS), using SPARQL query language. This service permits to retrieve lists of persons.
<br>Manual tests to retrieve lists of persons of a given professional group showed that full details of the persons can't be obtained because WDQS "times out" for queries that ask too many informations about persons. But to match Gauquelin data with Wikidata, g5 program needs full details of the persons.
<br>Tests also showed that queries asking minimal informations about persons (their Wikidata id and their name) don't time out.
<br>
<br>One solution could have been to retrieve the list of all humans and query them one by one. But the query to retrieve all humans at once times out.
<pre>
SELECT ?human ?humanLabel 
WHERE {
  ?human wdt:P31 wd:Q5 .
  SERVICE wikibase:label { bd:serviceParam wikibase:language "[AUTO_LANGUAGE],en" . }
}
</pre>

An other solution would be to install WDQS on a local machine, but this solution is quite heavy and was not explored (the compressed file containing data is 38 GB).
<br>
<br>The solution used involves several steps :

<ul>
    <li>
        <b>Step 1</b> : store list of occupation codes in <code>1-wd-raw/all-professions.csv</code>.
    </li>
    <li>
        <b>Step 2</b> : use these lists of profession codes to store lists of persons in <code>1-wd-raw/person-lists/</code> - uses json format.
    </li>
    <li>
        <b>Step 3</b> : use these lists of persons to store detailed persons in <code>1-wd-raw/persons/</code> - uses json format.
        <br>This directory is split in multiple sub-directories to avoid having too many files in a single directory.
    </li>
</ul>

<!-- ************************************* -->
<h3><a name="1-1-in-practice">In practice</a></h3>
<!-- 
Some sparql queries used to retrieve wikidata data are in directory <a href="https://github.com/tig12/gauquelin5/tree/master/share/wikidata.org">share/wikidata.org/</a>
-->

The files retrieved using WDQS are stored in <code>data/1-raw/wikidata.org</code> - This directory can be set using <code>1-wd-raw</code> entry of <code>config.yml</code>.
<br>
<br>This directory is organized like this :
<pre>
todo
</pre>



<!-- ********************************************************************************* -->
<h2><a name="step-1-get-occupation-codes">Step 1 - Get occupation codes</a></h2>

The wikidata entity used as a starting point is <code>profession Q28640</code><!--  (which is a subclass of <code>occupation Q12737077</code>) -->.
<br>The list of profession codes can be obtained with this query :
<pre>
SELECT ?profession ?professionLabel
WHERE{
    ?profession wdt:P31 wd:Q28640.
	SERVICE wikibase:label { bd:serviceParam wikibase:language "en" }
}
ORDER BY (?professionLabel)
</pre>

This gives more than 6000 profession codes.
<br>This query must be done by a human using <a href="https://query.wikidata.org/">the web interface of the WDQS</a>, and download the result as a csv stored in <code>1-wd-raw/all-professions.csv</code>.


<!-- ********************************************************************************* -->
<h2><a name="step-2-retrieve-lists-of-persons">Step 2 - Retrieve lists of persons</a></h2>

Using file <code>all-professions.csv</code>, this step stores the lists of persons for each profession code.
<br>It stores downloaded files in <code>1-wd-raw/person-lists</code>. This directory is split into multiple subdirectories to avoid too large number of files in a single directory.
<br>
<br>Before starting, directory <code>1-wd-raw/person-lists</code> must be created manually.
<br>
<br>Then files can be downloaded with the command :
<pre>php run-g5.php wd harvest lists</pre>
This command can be stopped and issued several times, it doesn't download files already downloaded.


<!-- ********************************************************************************* -->
<h2><a name="step-3-retrieve-persons-one-by-one">Step 3 - Retrieve persons one by one</a></h2>

<pre>php run-g5.php wd harvest persons</pre>

<hr class="margin">
The rest of this page contains old doc and is bound to be changed
<hr class="margin">

<!-- ********************************************************************************* -->
<h2><a name="try-elaborate-queries">Try elaborate queries</a></h2>

Previous step generates csv files containing profession (or occupation) codes. It is then possible to build one query per occupation code to retrieve the persons associated with this occupation, stored in <code>1-wd-raw/professionals/</code>.
<br>
<br>Example of query to try to retrieve mathematicians (Q170790) with information about each person :

<pre>
SELECT DISTINCT ?person ?personLabel ?familynameLabel ?linkcount ?isni ?macTutor ?birthdate ?birthplace ?birthplaceLabel ?birthiso3166 ?birthgeonamesid ?birthcoords ?deathdate ?deathplace ?deathplaceLabel ?deathiso3166 ?deathgeonamesid ?deathcoords ?deathcause ?deathcauseLabel WHERE {
    ?person ?P31 wd:Q170790;
        wdt:P734 ?familyname;
        # wdt:P735 ?givenname;
        wdt:P569 ?birthdate;
        wdt:P19 ?birthplace;
        wikibase:sitelinks ?linkcount .
    OPTIONAL { ?person wdt:P1563 ?macTutor } .
    OPTIONAL { ?person wdt:P213 ?isni } .
    # birth
    ?birthplace wdt:P625 ?birthcoords .
    OPTIONAL { ?birthplace wdt:P1566 ?birthgeonamesid } .
    OPTIONAL { ?birthplace wdt:P17 ?birthcountry }.
    OPTIONAL { ?birthcountry wdt:P297 ?birthiso3166 }.
    # death
    OPTIONAL { ?person wdt:P570 ?deathdate } .
    OPTIONAL { ?person wdt:P20 ?deathplace } .
    OPTIONAL { ?deathplace wdt:P625 ?deathcoords }.
    OPTIONAL { ?deathplace wdt:P1566 ?deathgeonamesid } .
    OPTIONAL { ?deathplace wdt:P17 ?deathcountry }.
    OPTIONAL { ?deathcountry wdt:P297 ?deathiso3166 }.
    OPTIONAL { ?person wdt:P509 ?deathcause }.
    #
    SERVICE wikibase:label { bd:serviceParam wikibase:language "en". }
}
ORDER BY DESC(?linkcount)
</pre>

This kind of query sometimes gives result for some profession codes, but often times out.


<!-- ********************************************************************************* -->
<h2><a name="use-minimal-queries">Use minimal queries</a></h2>

To circumvent time out, it is possible to write minimal queries, that will retrieve only the ids of the persons assoiated with a given profession code :

<pre>SELECT DISTINCT ?person ?personLabel
WHERE {
    ?person ?P31 wd:Q170790;
    SERVICE wikibase:label { bd:serviceParam wikibase:language "en". }
}
</pre>

<!-- ********************************************************************************* -->
<h2><a name="download-individual-json">Download individual json</a></h2>
Csv files generated by previous queries contain ids of persons, and these ids can be used to retrieve one by one json files containing the full informations about each person, using the per item access to wikidata.
<br>For example, <a href="http://www.wikidata.org/wiki/Special:EntityData/Q41390.json">wikidata.org/wiki/Special:EntityData/Q41390.json</a> contains informations about Kurt Gödel.



</article>
</div><!-- end class="main" -->


<!-- ************************************* -->
<aside class="left">                                                                                                                                              
<ul>
    <li class="bold big1"><a href="index.html">g5 Doc</a></li>
    <li class="bold big1"><a href="https://github.com/tig12/gauquelin5">g5 code</a></li>
    <li><a href="organisation.html">Organisation</a></li>
    <li><a href="usage.html">Program usage</a></li>
    
    <li>
        <span class="big1">1 - Restore</span>
        <ul>
            <li><a href="output-format.html">Output format</a></li>
            
            <li><a href="cura.html">Cura data</a></li>
            
            <li>
                <ul>
                    <a href="cura-A.html">A</a>
                    <a href="cura-D6.html">D6</a>
                    <a href="cura-D10.html">D10</a>
                    <a href="cura-E1-E3.html">E1 E3</a>
                <li><a href="cura-results.html">Results</a></li>
                </ul>
            </li>
            
            <li>
                <a href="g55.html">Gauquelin 1955</a>
                <ul>
                    <li><a href="g55-restore.html">Restoration</a></li>
                    <li><a href="g55-curadiff.html">Differences with Cura</a></li>
                </ul>
            </li>
            
            <li>
                <a href="newalch.html">Newalchemypress data</a>
                <ul>
                    <li><a href="newalch-ertel4391.html">Ertel 4391</a></li>
                    <li><a href="newalch-muller1083.html">Müller 1083</a></li>
                </ul>
            </li>
            
            <li><a href="time.html">Expressing time</a></li>
            
            <li>
                Steps
                <ul>
                    <li><a href="tweak2csv.html">tweak2csv</a></li>
                </ul>
            </li>
            
        </ul>
    </li>
    
    <li>
        <span class="big1">2 - Build new data</span>
        <ul>
            <li><a href="geonames.html">Geonames.org</a></li>
            <li><a href="wikidata.html">Wikidata.org</a></li>
        </ul>
    </li>
        
    <li>
        <span class="big1">3 - Eminence</span>
        <ul>
            <li><a href="eminence.html">Eminence ranking</a></li>
        </ul>
    </li>
    
    
    <li><a href="code-details.html">Code details</a></li>
    
    <!-- <li><a href="next.html">Next</a></li> -->
    
    <!-- <li><a href="questions.html">Questions</a></li> -->
    
    <li>
        Doc
        <ul>
            <li><a href="historical-tests.html">List of historical tests</a></li>
        </ul>
    </li>
    
    <li class="bold big1"><a href="https://larzac.info/gauquelin5">Download results</a></li>
    
</ul>
</aside>

</div><!-- end class="container" -->

</body>
</html>
<!-- ************************************* -->
<!-- ********************************************************************************* -->
