<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Wikidata | Gauquelin5</title>
    <link href="static/gauquelin5.css" rel="stylesheet" type="text/css">
    <meta name="description" content="">
    <meta name="robots" content="index,follow">
    <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
    <meta name="dcterms.rights" content="Creative commons by-sa 4.0">
    <meta name="dcterms.rightsHolder" content="Thierry Graff">
    <meta name="dcterms.dateCopyrighted" content="2019">
    <!-- 
    tigsite:
        history: , Thierry Graff : Creation
    -->
</head>

<body>
<div class="container">

<div class="main">

<nav class="prevnext">
    <a class="top" href="index.html">&uarr;</a>
</nav>

<header>
<h1>Wikidata integration</h1>
<div class="intro">
An important feature of "good data" is the ability to connect them to other datasets. This permits to check, eventually correct them, and provides means to build new datasets. Current page explores the possibility to connect Gauquelin data with <a href="https://www.wikidata.org">wikidata.org</a>. From wikidata, it's possible to link with other standard ids (ISNI, VIAF etc.).
<br>Matching wikidata with Gauquelin data has not (yet) been coded ; this page only explains how to retrieve relevant data from wikidata.org locally.
<br>
</div>
</header>

<article>
<nav class="toc">
    <ul>
        <li>
            <a href="#summary">Summary</a>
            <ul>
                <li><a href="#1-1-in-practice">In practice</a></li>
            </ul>
        </li>
        <li>
            <a href="#step-1-get-occupation-codes">Step 1 - Get occupation codes</a>
        </li>
        <li>
            <a href="#step-2-retrieve-lists-of-persons">Step 2 - Retrieve lists of persons</a>
        </li>
        <li>
            <a href="#step-3-retrieve-persons-one-by-one">Step 3 - Retrieve persons one by one</a>
        </li>
        <li>
            <a href="#try-elaborate-queries">Try elaborate queries</a>
        </li>
        <li>
            <a href="#use-minimal-queries">Use minimal queries</a>
        </li>
        <li>
            <a href="#download-individual-json">Download individual json</a>
        </li>
    </ul>
</nav>


<!-- ********************************************************************************* -->
<h2><a name="summary">Summary</a></h2>

Wikidata can be queried through <a href="https://query.wikidata.org/">Wikidata Query Service</a> (WDQS), using SPARQL query language. This service permits to retrieve lists of persons.
<br>Manual tests to retrieve lists of persons of a given professional group showed that full details of the persons can't be obtained because WDQS "times out" for queries that ask too many informations about persons. But to match Gauquelin data with Wikidata, g5 program needs full details of the persons.
<br>Tests also showed that queries asking minimal informations about persons (their Wikidata id and their name) don't time out.
<br>
<br>One solution could have been to retrieve the list of all humans and query them one by one. This query retrieve all humans ids (query asking also labels times out) :
<pre>SELECT ?human WHERE { ?human wdt:P31 wd:Q5 }</pre>
This gives 5 489 277 records (execution 2019-11-01). This is far too much : full data for a single human is around 100 Kb (json format), which would give more than 500 Gb of data (uncompressed).
<br>
<br>An other solution would be to install WDQS on a local machine, but this solution is quite heavy and was not explored (the compressed file containing data is 38 GB).
<br>
<br>An other solution would be to retrieve the list of occupation codes to retrieve only humans with a profession code. First step of this process was coded, with the folllowing query as departure point :
<pre>
SELECT ?profession ?professionLabel
WHERE{
    ?profession wdt:P31 wd:Q28640.
	SERVICE wikibase:label { bd:serviceParam wikibase:language "en" }
}
ORDER BY (?professionLabel)
</pre>
This gave more than 6000 profession codes, leading to 2 647 452 person ids, which is still too much.
<br>
<br>Finally, the adopted solution was to start from a subset of profession codes that corespond to Gauquelin data :

<table class="wikitable margin">
    <tr><th>Wikidata id</th><th>Profession</th></tr>
    <tr><td>Q483501</td><td>artist</td></tr>
    <tr><td>Q2066131</td><td>athlete</td></tr>
    <tr><td>Q482980</td><td>author</td></tr>
    <tr><td>Q189290</td><td>military-officer</td></tr>
    <tr><td>Q82955</td><td>politician</td></tr>
    <tr><td>Q39631</td><td>physician</td></tr>
    <tr><td>Q901</td><td>scientist</td></tr>
</table>
("athlete" seems to mean "sportman" in Wikidata vocabulary)
<br>
<br>This solution involves 3 steps :
<ul>
    <li>
        <b>Step 1</b> : store list of profession codes in <code>1-wd-raw/profession-lists</code>.
    </li>
    <li>
        <b>Step 2</b> : use these lists of profession codes to store lists of persons in <code>1-wd-raw/person-lists/</code>.
    </li>
    <li>
        <b>Step 3</b> : use these lists of persons to store detailed persons in <code>1-wd-raw/persons/</code>.
    </li>
</ul>

<!-- ************************************* -->
<h3><a name="1-1-in-practice">In practice</a></h3>
The files retrieved using WDQS are stored in <code>data/1-raw/wikidata.org</code> - This directory can be set using <code>1-wd-raw</code> entry of <code>config.yml</code>.
<br>
<br>This directory is organized like this :
<pre>
todo
</pre>

<!-- ********************************************************************************* -->
<h2><a name="step-1-get-profession-codes">Step 1 - Get profession codes</a></h2>
This is done with command 
<pre>php run-g5.php wd harvest occus</pre>
It uses as departure point the list of profession codes stored in <code>Wikidata::OCCUPATION_SEEDS</code> (artist ... scientist).
<br>It stores its result in directory <code>1-wd-raw/profession-lists/</code>


<!-- ********************************************************************************* -->
<h2><a name="step-2-retrieve-lists-of-persons">Step 2 - Retrieve lists of persons</a></h2>

Using the files stored in <code>1-wd-raw/profession-lists/</code>, this step stores the lists of persons for each profession code.
<br>It stores downloaded json files in sub-directories of <code>1-wd-raw/person-lists</code>.
<br>
<br>The files are downloaded with the command :
<pre>php run-g5.php wd harvest personLists</pre>
This command can be stopped and issued several times, it doesn't download files already downloaded.
<br>
<br>An execution of this command on 2019-11-02 gave 592 profession codes containing 790 394 person ids, using 560 Mb.

<!-- ********************************************************************************* -->
<h2><a name="step-3-retrieve-persons-one-by-one">Step 3 - Retrieve persons one by one</a></h2>

The program must permit to execute this step in several execution ; 800 000 is too big to write simple code that will check all the persons already retrieved at each execution. So a mechanism using a sqlite database was written to assist person retrieval. 
<br>
<br>This operation is done in two steps :
<pre>php run-g5.php wd harvest persons prepare</pre>
Builds the sqlite database and stores the person ids.
<br>It contains one table with two columns :
<ul>
    <li><code>id</code> : id of the person to download.</li>
    <li><code>done</code> : boolean indicating if the person has already been downloaded or not.</li>
</ul>

After doublon removal, it shows that previous step has retrieved <b>765 937</b> ids (doublons are due to the fact that one person can be associated to several occupation codes).

Then the command
<pre>php run-g5.php wd harvest persons dl</pre>
downloads the persons one by one. The command can be executed, stoped and started again and again. It uses the sqlite database to know which persons remain to retrieve.

</article>
</div><!-- end class="main" -->


<!-- ************************************* -->
<aside class="left">                                                                                                                                              
<ul>
    <li class="bold big1"><a href="index.html">g5 Doc</a></li>
    <li class="bold big1"><a href="https://github.com/tig12/gauquelin5">g5 code</a></li>
    <li><a href="organisation.html">Organisation</a></li>
    <li><a href="usage.html">Program usage</a></li>
    
    <li>
        <span class="big1">1 - Restore</span>
        <ul>
            <li><a href="output-format.html">Output format</a></li>
            
            <li><a href="cura.html">Cura data</a></li>
            
            <li>
                <ul>
                    <a href="cura-A.html">A</a>
                    <a href="cura-D6.html">D6</a>
                    <a href="cura-D10.html">D10</a>
                    <a href="cura-E1-E3.html">E1 E3</a>
                <li><a href="cura-results.html">Results</a></li>
                </ul>
            </li>
            
            <li>
                <a href="g55.html">Gauquelin 1955</a>
                <ul>
                    <li><a href="g55-restore.html">Restoration</a></li>
                    <li><a href="g55-curadiff.html">Differences with Cura</a></li>
                </ul>
            </li>
            
            <li>
                <a href="newalch.html">Newalchemypress data</a>
                <ul>
                    <li><a href="newalch-ertel4391.html">Ertel 4391</a></li>
                    <li><a href="newalch-muller1083.html">MÃ¼ller 1083</a></li>
                </ul>
            </li>
            
            <li><a href="time.html">Expressing time</a></li>
            
            <li>
                Steps
                <ul>
                    <li><a href="tweak2csv.html">tweak2csv</a></li>
                </ul>
            </li>
            
        </ul>
    </li>
    
    <li>
        <span class="big1">2 - Build new data</span>
        <ul>
            <li><a href="geonames.html">Geonames.org</a></li>
            <li><a href="wikidata.html">Wikidata.org</a></li>
        </ul>
    </li>
        
    <li>
        <span class="big1">3 - Eminence</span>
        <ul>
            <li><a href="eminence.html">Eminence ranking</a></li>
        </ul>
    </li>
    
    
    <li><a href="code-details.html">Code details</a></li>
    
    <!-- <li><a href="next.html">Next</a></li> -->
    
    <!-- <li><a href="questions.html">Questions</a></li> -->
    
    <li>
        Doc
        <ul>
            <li><a href="historical-tests.html">List of historical tests</a></li>
        </ul>
    </li>
    
    <li class="bold big1"><a href="https://larzac.info/gauquelin5">Download results</a></li>
    
</ul>
</aside>

</div><!-- end class="container" -->

</body>
</html>
<!-- ************************************* -->
<!-- ********************************************************************************* -->
